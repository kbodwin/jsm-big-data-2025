{
  "hash": "1715243a6cd3a36eea3ac0bca9013eea",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Hands-on practice: Analysis with PUMS Data\"\neditor: source\n---\n\n\n## The PUMS Dataset\n\n::: {.incremental}\n- **Public Use Microdata Sample**\n  - US Census Bureau data\n  - Individual person and household records\n  - Anonymized demographic information\n  - Income, education, housing, commute, etc.\n\n- **Dataset characteristics:**\n  - Multiple years (2005-2022, sans 2020)\n  - All US states and territories\n  - 53 Million rows (person only)\n  - 200+ variables\n:::\n\n## Reading Partitioned PUMS Data\n\n::: panel-tabset\n### Problems\n\n* Load the PUMS person data as an arrow dataset\n* What are the dimensions of the dataset? Number of rows? Number of columns?\n* Examine the dataset:\n  * What columns does the dataset have?\n  * What are the column types?\n\n### Hints\n\nYou can use `arrow::open_dataset(...)` to open a dataset. Treat the dataset like it's a data frame, can you use the same functions that you are already familiar with?\n\n### Solution\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(arrow)\nlibrary(dplyr)\n\n# Open the PUMS dataset\npums_ds <- open_dataset(\"~/PUMS/data/person\")\n\n# dimensions\nnrow(pums_ds)\nncol(pums_ds)\n\n# Examine the dataset\npums_ds\n\n# Examine schema\nschema(pums_ds)\n```\n:::\n\n:::\n\n## Exercise 1: Basic Filtering and Aggregation\n\n::: panel-tabset\n### Problems\n\n### Solution\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate average income by state for 2021\nresult1 <- pums_ds |>\n  filter(year == 2021) |>\n  filter(PINCP > 0) |>  # Positive income only\n  group_by(location) |>\n  summarize(\n    avg_income = mean(PINCP, na.rm = TRUE),\n    median_income = quantile(PINCP, 0.5, na.rm = TRUE),\n    n = n()\n  ) |>\n  arrange(desc(avg_income)) |>\n  collect()\n\n# View results\nhead(result1)\n```\n:::\n\n:::\n\n## Exercise 2: Using DuckDB with PUMS Data\n\n::: panel-tabset\n### Problems\n\n### Solution\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(arrow)\nlibrary(duckdb)\nlibrary(DBI)\n\n# Open the PUMS dataset with Arrow\npums_ds <- open_dataset(\"data/person\")\n\n# Filter to just 2021 data for Washington\nwa_2021 <- pums_ds |>\n  filter(year == 2021, location == \"wa\") |>\n  collect()\n\n# Create DuckDB connection\ncon <- dbConnect(duckdb())\n\n# Register Arrow Table with DuckDB\nduckdb::duckdb_register_arrow(con, \"pums_wa\", wa_2021)\n\n# Run SQL query\nresult <- dbGetQuery(con, \"\n  SELECT \n    CASE \n      WHEN AGEP < 18 THEN 'Under 18'\n      WHEN AGEP < 30 THEN '18-29'\n      WHEN AGEP < 45 THEN '30-44'\n      WHEN AGEP < 65 THEN '45-64'\n      ELSE '65+'\n    END AS age_group,\n    AVG(JWMNP) AS avg_commute_time,\n    COUNT(*) AS n\n  FROM pums_wa\n  WHERE JWMNP > 0\n  GROUP BY age_group\n  ORDER BY age_group\n\")\n\n# Disconnect when done\ndbDisconnect(con, shutdown = TRUE)\n```\n:::\n\n:::\n\n## Challenge: Formulate Your Own Analysis\n\n- **Choose a research question:**\n  - How has commute time changed over the years?\n  - What's the relationship between education and income?\n  - How does housing cost burden vary by state?\n  - Your own question...\n\n- **Implement the analysis using:**\n  - Arrow Dataset operations\n  - DuckDB SQL queries\n  - Data visualization\n\n- **Compare performance between approaches**\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}